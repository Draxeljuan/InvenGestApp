<div class="sidebar">
  <div class="logo">
    <h2>InvenGest Admin</h2>
  </div>
  <nav class="menu">
    <div class="menu-item" routerLink="/dashboard" routerLinkActive="active">
      <span>ğŸ“Š Dashboard</span>
    </div>
    <div class="menu-item" routerLink="/inventario" routerLinkActive="active">
      <span>ğŸ“¦ Inventario</span>
    </div>
    <div class="menu-item" routerLink="/movimientos-inventario" routerLinkActive="active">
      <span>ğŸ”„ Mov. Inventario</span>
    </div>
    <div class="menu-item" routerLink="/reportes" routerLinkActive="active">
      <span>ğŸ“Š Reportes</span>
    </div>
    <div class="menu-item" routerLink="/ventas" routerLinkActive="active">
      <span>ğŸ’° Ventas</span>
    </div>
    <div class="menu-item" routerLink="/historial-ventas" routerLinkActive="active">
      <span>ğŸ“œ Historial Ventas</span>
    </div>
    <div class="menu-item" routerLink="/buscar-producto" routerLinkActive="active">
      <span>ğŸ” Buscar Producto</span>
    </div>
    <div class="menu-item" routerLink="/alertas" routerLinkActive="active">
      <span>ğŸ”” Alertas</span>
    </div>
    <div class="menu-item" routerLink="/backups" routerLinkActive="active">
      <span>ğŸ’¾ GestiÃ³n Backups</span>
    </div>
    <div class="menu-item" routerLink="/perfil" routerLinkActive="active">
      <span>ğŸ‘¤ Perfil</span>
    </div>
    <div class="menu-item logout-btn" (click)="logoutService.openModal()">
      <span>ğŸ“¤ Cerrar sesiÃ³n</span>
    </div>
  </nav>
</div>

<div class="main-content">
  <div class="header">
    <h1>ğŸ’¾ GestiÃ³n de Backups</h1>
    <div class="fecha-actual">
      ğŸ“… {{ fechaActual | date:'dd/MM/yyyy' }}
    </div>
  </div>

  <!-- Advertencia importante -->
  <div class="alert-warning">
    <div class="alert-icon">âš ï¸</div>
    <div class="alert-content">
      <h3>Â¡AtenciÃ³n! AcciÃ³n Importante</h3>
      <p>Restaurar un backup reemplazarÃ¡ <strong>todos los datos actuales</strong> del sistema. AsegÃºrate de tener un backup reciente antes de continuar.</p>
    </div>
  </div>

  <!-- Tarjetas de estadÃ­sticas -->
  <div class="stats-cards">
    <div class="stat-card info-card">
      <div class="stat-icon">ğŸ“</div>
      <div class="stat-info">
        <h3>Backups Disponibles</h3>
        <p class="stat-value">{{ backupsDisponibles }}</p>
        <span class="stat-label">Archivos en servidor</span>
      </div>
    </div>

    <div class="stat-card success-card">
      <div class="stat-icon">âœ…</div>
      <div class="stat-info">
        <h3>Ãšltima RestauraciÃ³n</h3>
        <p class="stat-value">{{ ultimaRestauracion || 'Nunca' }}</p>
        <span class="stat-label">Fecha</span>
      </div>
    </div>

    
  </div>

  <!-- Contenedor principal -->
  <div class="backup-container">
    
    <!-- SecciÃ³n de creaciÃ³n de backup -->
    <div class="create-backup-section" *ngIf="!archivoSeleccionado && !procesandoBackup && !creandoBackup">
      <div class="create-backup-card">
        <div class="create-header">
          <h2>ğŸ“¥ Crear Nuevo Backup</h2>
          <p>Genera un respaldo completo de tu base de datos actual</p>
        </div>
        
        

        <button class="btn-create-backup" (click)="crearNuevoBackup()" [disabled]="creandoBackup">
          <span *ngIf="!creandoBackup"> Crear Backup Ahora</span>
          <span *ngIf="creandoBackup"> Creando Backup...</span>
        </button>

        <p class="create-note">ğŸ’¡ Se recomienda crear backups regularmente, especialmente antes de realizar cambios importantes</p>
      </div>
    </div>

    <!-- Proceso de creaciÃ³n de backup -->
    <div class="processing-section" *ngIf="creandoBackup">
      <div class="processing-card">
        <div class="spinner-container">
          <div class="spinner"></div>
        </div>
        <h2>ğŸ”„ Creando Backup...</h2>
        <p class="processing-message">Por favor espera mientras se genera el respaldo de tu base de datos</p>
        
        <div class="process-info">
          <p>â±ï¸ Este proceso puede tomar algunos segundos...</p>
          <p>ğŸ“¦ Se estÃ¡n respaldando todos los datos del sistema</p>
        </div>
      </div>
    </div>

    <!-- Resultado exitoso de creaciÃ³n -->
    <div class="result-section success" *ngIf="backupCreadoExitoso">
      <div class="result-card">
        <div class="result-icon success-icon">âœ…</div>
        <h2>Â¡Backup Creado Exitosamente!</h2>
        <p>El respaldo de tu base de datos se ha generado correctamente</p>
        
        <div class="backup-created-info" *ngIf="backupCreadoInfo">
          <div class="info-row">
            <span class="info-label">ğŸ“ Archivo:</span>
            <span class="info-value">{{ backupCreadoInfo.fileName }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">ğŸ“ UbicaciÃ³n:</span>
            <span class="info-value">{{ backupCreadoInfo.filePath }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">ğŸ• Fecha:</span>
            <span class="info-value">{{ backupCreadoInfo.createdDate }}</span>
          </div>
        </div>

        <div class="result-actions">
          <button class="btn-primary" (click)="volverAInicio()">
            ğŸ’¾ Crear Otro Backup
          </button>
          <button class="btn-secondary" (click)="mostrarListaBackups()">
            ğŸ“‹ Ver Todos los Backups
          </button>
        </div>
      </div>
    </div>

    <!-- Zona de carga de archivos / Lista de backups -->
    <div class="upload-section" *ngIf="!archivoSeleccionado && !procesandoBackup && !creandoBackup && !backupCreadoExitoso">
      
      <!-- Lista de backups recientes -->
      <div class="backups-recientes">
        <div class="backups-header">
          <h3>ğŸ“‹ Backups Disponibles en el Servidor</h3>
          <button class="btn-refresh" (click)="cargarBackupsRecientes()" [disabled]="cargandoBackups">
            <span *ngIf="!cargandoBackups"> Actualizar</span>
            <span *ngIf="cargandoBackups"> Cargando...</span>
          </button>
        </div>

        <div *ngIf="cargandoBackups" class="loading-backups">
          <div class="small-spinner"></div>
          <p>Cargando backups disponibles...</p>
        </div>

        <div *ngIf="!cargandoBackups && backupsRecientes.length === 0" class="no-backups">
          <span class="no-backups-icon">ğŸ“­</span>
          <p>No hay backups disponibles en el servidor</p>
          <p class="no-backups-hint">Crea tu primer backup para comenzar</p>
        </div>

        <div class="backup-list" *ngIf="!cargandoBackups && backupsRecientes.length > 0">
          <div class="backup-item" *ngFor="let backup of backupsRecientes" (click)="seleccionarBackupServidor(backup)">
            <div class="backup-icon">ğŸ“</div>
            <div class="backup-info">
              <span class="backup-name">{{ backup.name }}</span>
              <span class="backup-date">{{ backup.createdDate | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <div class="backup-size">{{ backup.sizeMB }} MB</div>
            <button class="btn-select">Seleccionar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Vista previa del archivo seleccionado -->
    <div class="preview-section" *ngIf="archivoSeleccionado && !procesandoBackup">
      <div class="preview-card">
        <div class="preview-header">
          <h2>ğŸ“‹ InformaciÃ³n del Backup</h2>
          <button class="btn-close" (click)="cancelarSeleccion()">âœ•</button>
        </div>

        <div class="file-details">
          <div class="detail-row">
            <span class="detail-label">Archivo:</span>
            <span class="detail-value">{{ archivoSeleccionado.name }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">TamaÃ±o:</span>
            <span class="detail-value">{{ formatearTamano(archivoSeleccionado.size) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Tipo:</span>
            <span class="detail-value">{{ archivoSeleccionado.type || 'application/sql' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Fecha de modificaciÃ³n:</span>
            <span class="detail-value">{{ archivoSeleccionado.lastModified | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
        </div>

        <!-- Checklist de confirmaciÃ³n -->
        <div class="confirmation-checklist">
          <h3>âœ“ Confirma que entiendes:</h3>
          <label class="checkbox-item">
            <input type="checkbox" [(ngModel)]="confirmaciones.backup">
            <span>He creado un backup reciente de los datos actuales</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" [(ngModel)]="confirmaciones.perdida">
            <span>Entiendo que los datos actuales serÃ¡n reemplazados</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" [(ngModel)]="confirmaciones.irreversible">
            <span>Confirmo que esta acciÃ³n no se puede deshacer fÃ¡cilmente</span>
          </label>
        </div>

        <!-- Botones de acciÃ³n -->
        <div class="action-buttons">
          <button class="btn-cancel" (click)="cancelarSeleccion()">
            âŒ Cancelar
          </button>
          <button class="btn-restore" 
                  [disabled]="!todasConfirmaciones()"
                  (click)="iniciarRestauracion()">
            ğŸ’¾ Restaurar Backup
          </button>
        </div>
      </div>
    </div>

    <!-- Proceso de restauraciÃ³n -->
    <div class="processing-section" *ngIf="procesandoBackup">
      <div class="processing-card">
        <div class="spinner-container">
          <div class="spinner"></div>
        </div>
        <h2>ğŸ”„ Restaurando Backup...</h2>
        <p class="processing-message">{{ mensajeProceso }}</p>
        
        <!-- Barra de progreso -->
        <div class="progress-container">
          <div class="progress-bar-bg">
            <div class="progress-bar-fill" [style.width.%]="progreso"></div>
          </div>
          <span class="progress-text">{{ progreso }}% completado</span>
        </div>

        <!-- Pasos del proceso -->
        <div class="process-steps">
          <div class="step" [class.completed]="progreso >= 20" [class.active]="progreso < 20">
            <span class="step-icon">{{ progreso >= 20 ? 'âœ…' : 'â³' }}</span>
            <span>Validando archivo</span>
          </div>
          <div class="step" [class.completed]="progreso >= 40" [class.active]="progreso >= 20 && progreso < 40">
            <span class="step-icon">{{ progreso >= 40 ? 'âœ…' : 'â³' }}</span>
            <span>Extrayendo datos</span>
          </div>
          <div class="step" [class.completed]="progreso >= 60" [class.active]="progreso >= 40 && progreso < 60">
            <span class="step-icon">{{ progreso >= 60 ? 'âœ…' : 'â³' }}</span>
            <span>Limpiando base de datos</span>
          </div>
          <div class="step" [class.completed]="progreso >= 80" [class.active]="progreso >= 60 && progreso < 80">
            <span class="step-icon">{{ progreso >= 80 ? 'âœ…' : 'â³' }}</span>
            <span>Restaurando informaciÃ³n</span>
          </div>
          <div class="step" [class.completed]="progreso >= 100" [class.active]="progreso >= 80 && progreso < 100">
            <span class="step-icon">{{ progreso >= 100 ? 'âœ…' : 'â³' }}</span>
            <span>Verificando integridad</span>
          </div>
        </div>

        <p class="warning-text">âš ï¸ No cierres esta ventana hasta que el proceso termine</p>
      </div>
    </div>

    <!-- Resultado exitoso -->
    <div class="result-section success" *ngIf="restauracionExitosa">
      <div class="result-card">
        <div class="result-icon success-icon">âœ…</div>
        <h2>Â¡RestauraciÃ³n Completada!</h2>
        <p>El backup se ha restaurado correctamente. El sistema estÃ¡ listo para usar.</p>

        <div class="result-actions">
          <button class="btn-primary" routerLink="/dashboard">
            ğŸ“Š Ir al Dashboard
          </button>
          <button class="btn-secondary" (click)="resetearFormulario()">
            ğŸ’¾ Restaurar Otro Backup
          </button>
        </div>
      </div>
    </div>

    <!-- Resultado con error -->
    <div class="result-section error" *ngIf="errorRestauracion">
      <div class="result-card">
        <div class="result-icon error-icon">âŒ</div>
        <h2>Error en la RestauraciÃ³n</h2>
        <p class="error-message">{{ mensajeError }}</p>
        
        <div class="error-details">
          <h4>Posibles causas:</h4>
          <ul>
            <li>El archivo de backup estÃ¡ corrupto o incompleto</li>
            <li>El formato del archivo no es compatible</li>
            <li>No hay suficiente espacio en el servidor</li>
            <li>Problemas de conexiÃ³n durante el proceso</li>
          </ul>
        </div>

        <div class="result-actions">
          <button class="btn-primary" (click)="resetearFormulario()">
            ğŸ”„ Intentar Nuevamente
          </button>
          <button class="btn-secondary" routerLink="/dashboard">
            ğŸ“Š Volver al Dashboard
          </button>
        </div>
      </div>
    </div>

  </div>

  <!-- InformaciÃ³n adicional -->
  <div class="info-panel">
    <h3>InformaciÃ³n Importante</h3>
    <div class="info-content">
      <div class="info-item">
        <strong>Antes de restaurar:</strong>
        <p>Crea un backup actual de tu sistema para poder volver atrÃ¡s si es necesario.</p>
      </div>
      <div class="info-item">
        <strong>Durante el proceso:</strong>
        <p>No cierres el navegador ni actualices la pÃ¡gina. La restauraciÃ³n no deberia tardar mucho...</p>
      </div>
      <div class="info-item">
        <strong>DespuÃ©s de restaurar:</strong>
        <p>Verifica que todos los datos se hayan restaurado correctamente antes de continuar operando.</p>
      </div>
    </div>
  </div>

</div>